<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Kepubify</title>
    <link rel="stylesheet" href="style.css">
    <meta name="author" content="Patrick G">
    <meta name="description" content="Kepubify is a epub to kepub conversion tool. Kepubify is fast, easy-to-use, and cross platform. Kepubify is written in Go, and released under the MIT license.">
</head>

<body>
    <div class="nav">
        <div class="brand">
            <div class="name">kepubify</div>
            <div class="description">An epub to kepub converter</div>
        </div>
        <div class="buttons">
            <a href="docs.html" class="button">Documentation</a>
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="about">
        <div class="text">
            <p>
                Kepubify is a epub to kepub conversion tool. Kepubify is fast, easy-to-use, and cross platform. Kepubify is written in Go,
                and released under the MIT license.
            </p>
            <a target="_blank" href="https://github.com/geek1011/kepubify/releases/latest" id="download" class="button primary">Download</a>
            <a style="display:none;font-size:12px;" target="_blank" id="other-platforms" href="https://github.com/geek1011/kepubify/releases/latest">Other Platforms</a>
            <br>
            <b>Features</b>
            <ul>
                <li>Full support of all kepub features</li>
                <li>Batch conversion</li>
                <li>Fast (about 12x faster than Calibre)</li>
                <li>Works from the command line</li>
                <li>Update Kobo series metadata</li>
                <li>Does not add any extra metadata (unlike Calibre)</li>
            </ul>
            <a target="_blank" href="https://github.com/geek1011/kepubify/releases">Changelog</a> | <a target="_blank" href="https://github.com/geek1011/kepubify">Source Code</a>
            <p>
                Also see: <a href="https://geek1011.github.io/KoboStuff/kobofirmware.html">Kobo Firmware Downloader</a>.
            </p>
        </div>
        <div class="screenshot">
            <img id="screenshot" src="kepubify-windows.gif">
        </div>
    </div>
    <div class="footer">Copyright 2017 Patrick G</div>

    <script>
        var getParameterByName = function (name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return "";
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        var os = (function () {
            var userAgent = window.navigator.userAgent,
                platform = window.navigator.platform;

            if (["macOS", "iOS", "Windows", "Android", "Linux"].indexOf(getParameterByName("os")) > -1) return getParameterByName(
                "os");
            if (["Macintosh", "MacIntel", "MacPPC", "Mac68K"].indexOf(platform) > -1) return "macOS";
            if (["iPhone", "iPad", "iPod"].indexOf(platform) > -1) return "iOS";
            if (["Win32", "Win64", "Windows", "WinCE"].indexOf(platform) > -1) return "Windows";
            if (/Android/.test(userAgent)) return "Android";
            if (/Linux/.test(platform)) return "Linux";
        })();

        var getRelease = function (onSuccess, onError) {
            var req;
            var url = "https://api.github.com/repos/geek1011/kepubify/releases/latest";
//return;
            if (XMLHttpRequest) {
                req = new XMLHttpRequest();

                if ('withCredentials' in req) {
                    req.open("GET", url, true);
                    req.onerror = onError;
                    req.onreadystatechange = function () {
                        if (req.readyState === 4) {
                            if (req.status >= 200 && req.status < 400) {
                                try {
                                    onSuccess(JSON.parse(req.responseText));
                                } catch (ex) {
                                    onError(ex);
                                }
                            } else {
                                onError(new Error('Response returned with non-OK status'));
                            }
                        }
                    };
                    req.send();
                }
            } else if (XDomainRequest) {
                req = new XDomainRequest();
                req.open("GET", url);
                req.onerror = onError;
                req.onload = function () {
                    try {
                        onSuccess(JSON.parse(req.responseText));
                    } catch (ex) {
                        onError(ex);
                    }
                };
                req.send();
            } else {
                onError(new Error('CORS not supported'));
            }
        }

        if (os == "Linux" || os == "macOS") document.getElementById("screenshot").src = "kepubify.gif";

        getRelease(function (release) {
            console.log(release);

            var button = document.getElementById("download");
            var otherPlatforms = document.getElementById("other-platforms");

            var urls = {};
            for (var i = 0; i < release.assets.length; i++) {
                urls[release.assets[i].name] = release.assets[i].browser_download_url;
            }

            if (os == "Windows" && urls["kepubify-windows-32bit.exe"]) {
                otherPlatforms.style.display = "block";
                button.href = urls["kepubify-windows-32bit.exe"];
                button.target = "_blank";
                button.innerHTML = "Download for Windows";
            } else if (os == "Linux" && urls["kepubify-linux-64bit"]) {
                otherPlatforms.style.display = "block";
                button.href = urls["kepubify-linux-64bit"];
                button.target = "_blank";
                button.innerHTML = "Download for Linux";
            } else if (os == "macOS" && urls["kepubify-darwin-64bit"]) {
                otherPlatforms.style.display = "block";
                button.href = urls["kepubify-darwin-64bit"];
                button.target = "_blank";
                button.innerHTML = "Download for macOS";
            }

            button.addEventListener("click", function() {
                window.setTimeout(function(){
                    window.location = "docs.html";
                }, 500);
            })
        }, function (err) {
            console.error(err);
        })
    </script>
</body>

</html>